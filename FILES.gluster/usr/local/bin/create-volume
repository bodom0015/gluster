#!/bin/sh
#
# Usage: sh create-volume
#

HOSTS=(192.168.100.89 192.168.100.156)

VOLNAME="ndslabs"
VOLPATH="/var/glfs/$VOLNAME"
BRKPATH="$VOLPATH/brick0"

EXISTS=`gluster volume list | grep "$VOLNAME"`

if [[ "$EXISTS" == "No volumes present in cluster" ]]; then
	# Remove existing data (stale bricks)
	if [[ -d "$VOLPATH" ]]; then
		sudo rm -rf "$VOLPATH"
		mkdir -p "$VOLPATH"
	fi

	BRICKS=""
	for i in "$HOSTS[@]"; do
		BRICKS="$i:$BRKPATH $BRICKS"
	done

	# Create a new gluster volume 
	gluster volume create $VOLNAME transport tcp $BRICKS

	# Start serving the new volume
	gluster volume start $VOLNAME
fi

